*---------------------------------------------------------------------*
*    view related FORM routines
*---------------------------------------------------------------------*
*...processing: ZOSFEVA_CATACONS................................*
FORM GET_DATA_ZOSFEVA_CATACONS.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSFETB_CATACONS WHERE
(VIM_WHERETAB) .
    CLEAR ZOSFEVA_CATACONS .
ZOSFEVA_CATACONS-MANDT =
ZOSFETB_CATACONS-MANDT .
ZOSFEVA_CATACONS-ZZ_VERUBL =
ZOSFETB_CATACONS-ZZ_VERUBL .
ZOSFEVA_CATACONS-ZZ_CATALOGO =
ZOSFETB_CATACONS-ZZ_CATALOGO .
ZOSFEVA_CATACONS-ZZ_TAGID =
ZOSFETB_CATACONS-ZZ_TAGID .
ZOSFEVA_CATACONS-ZZ_TAGAGENCYNAME =
ZOSFETB_CATACONS-ZZ_TAGAGENCYNAME .
ZOSFEVA_CATACONS-ZZ_TAGNAME =
ZOSFETB_CATACONS-ZZ_TAGNAME .
ZOSFEVA_CATACONS-ZZ_TAGURI =
ZOSFETB_CATACONS-ZZ_TAGURI .
<VIM_TOTAL_STRUC> = ZOSFEVA_CATACONS.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSFEVA_CATACONS .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSFEVA_CATACONS.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSFEVA_CATACONS-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSFETB_CATACONS WHERE
  ZZ_VERUBL = ZOSFEVA_CATACONS-ZZ_VERUBL AND
  ZZ_CATALOGO = ZOSFEVA_CATACONS-ZZ_CATALOGO .
    IF SY-SUBRC = 0.
    DELETE ZOSFETB_CATACONS .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSFETB_CATACONS WHERE
  ZZ_VERUBL = ZOSFEVA_CATACONS-ZZ_VERUBL AND
  ZZ_CATALOGO = ZOSFEVA_CATACONS-ZZ_CATALOGO .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSFETB_CATACONS.
    ENDIF.
ZOSFETB_CATACONS-MANDT =
ZOSFEVA_CATACONS-MANDT .
ZOSFETB_CATACONS-ZZ_VERUBL =
ZOSFEVA_CATACONS-ZZ_VERUBL .
ZOSFETB_CATACONS-ZZ_CATALOGO =
ZOSFEVA_CATACONS-ZZ_CATALOGO .
ZOSFETB_CATACONS-ZZ_TAGID =
ZOSFEVA_CATACONS-ZZ_TAGID .
ZOSFETB_CATACONS-ZZ_TAGAGENCYNAME =
ZOSFEVA_CATACONS-ZZ_TAGAGENCYNAME .
ZOSFETB_CATACONS-ZZ_TAGNAME =
ZOSFEVA_CATACONS-ZZ_TAGNAME .
ZOSFETB_CATACONS-ZZ_TAGURI =
ZOSFEVA_CATACONS-ZZ_TAGURI .
    IF SY-SUBRC = 0.
    UPDATE ZOSFETB_CATACONS .
    ELSE.
    INSERT ZOSFETB_CATACONS .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSFEVA_CATACONS-UPD_FLAG,
STATUS_ZOSFEVA_CATACONS-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSFEVA_CATACONS.
  SELECT SINGLE * FROM ZOSFETB_CATACONS WHERE
ZZ_VERUBL = ZOSFEVA_CATACONS-ZZ_VERUBL AND
ZZ_CATALOGO = ZOSFEVA_CATACONS-ZZ_CATALOGO .
ZOSFEVA_CATACONS-MANDT =
ZOSFETB_CATACONS-MANDT .
ZOSFEVA_CATACONS-ZZ_VERUBL =
ZOSFETB_CATACONS-ZZ_VERUBL .
ZOSFEVA_CATACONS-ZZ_CATALOGO =
ZOSFETB_CATACONS-ZZ_CATALOGO .
ZOSFEVA_CATACONS-ZZ_TAGID =
ZOSFETB_CATACONS-ZZ_TAGID .
ZOSFEVA_CATACONS-ZZ_TAGAGENCYNAME =
ZOSFETB_CATACONS-ZZ_TAGAGENCYNAME .
ZOSFEVA_CATACONS-ZZ_TAGNAME =
ZOSFETB_CATACONS-ZZ_TAGNAME .
ZOSFEVA_CATACONS-ZZ_TAGURI =
ZOSFETB_CATACONS-ZZ_TAGURI .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSFEVA_CATACONS USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSFEVA_CATACONS-ZZ_VERUBL TO
ZOSFETB_CATACONS-ZZ_VERUBL .
MOVE ZOSFEVA_CATACONS-ZZ_CATALOGO TO
ZOSFETB_CATACONS-ZZ_CATALOGO .
MOVE ZOSFEVA_CATACONS-MANDT TO
ZOSFETB_CATACONS-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSFETB_CATACONS'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSFETB_CATACONS TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSFETB_CATACONS'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO01................................*
FORM GET_DATA_ZOSVA_CATALOGO01.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO01 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO01 .
ZOSVA_CATALOGO01-MANDT =
ZOSTB_CATALOGO01-MANDT .
ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO01-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO01-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO01-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO01-ZZ_UN =
ZOSTB_CATALOGO01-ZZ_UN .
ZOSVA_CATALOGO01-ZZ_OPCION01 =
ZOSTB_CATALOGO01-ZZ_OPCION01 .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO01.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO01 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO01.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO01-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO01 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO01 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO01 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO01.
    ENDIF.
ZOSTB_CATALOGO01-MANDT =
ZOSVA_CATALOGO01-MANDT .
ZOSTB_CATALOGO01-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO01-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO01-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO01-ZZ_UN =
ZOSVA_CATALOGO01-ZZ_UN .
ZOSTB_CATALOGO01-ZZ_OPCION01 =
ZOSVA_CATALOGO01-ZZ_OPCION01 .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO01 .
    ELSE.
    INSERT ZOSTB_CATALOGO01 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO01-UPD_FLAG,
STATUS_ZOSVA_CATALOGO01-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO01.
  SELECT SINGLE * FROM ZOSTB_CATALOGO01 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO01-MANDT =
ZOSTB_CATALOGO01-MANDT .
ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO01-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO01-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO01-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO01-ZZ_UN =
ZOSTB_CATALOGO01-ZZ_UN .
ZOSVA_CATALOGO01-ZZ_OPCION01 =
ZOSTB_CATALOGO01-ZZ_OPCION01 .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO01 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO01-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO01-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO01-MANDT TO
ZOSTB_CATALOGO01-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO01'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO01 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO01'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO03................................*
FORM GET_DATA_ZOSVA_CATALOGO03.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO03 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO03 .
ZOSVA_CATALOGO03-MANDT =
ZOSTB_CATALOGO03-MANDT .
ZOSVA_CATALOGO03-MEINS =
ZOSTB_CATALOGO03-MEINS .
ZOSVA_CATALOGO03-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO03-ZZ_CODIGO_SUNAT .
    SELECT SINGLE * FROM T006 WHERE
MSEHI = ZOSTB_CATALOGO03-MEINS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T006A WHERE
MSEHI = T006-MSEHI AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
ZOSVA_CATALOGO03-MSEHT =
T006A-MSEHT .
      ENDIF.
    ENDIF.
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO03.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO03 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO03.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO03-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO03 WHERE
  MEINS = ZOSVA_CATALOGO03-MEINS .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO03 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO03 WHERE
  MEINS = ZOSVA_CATALOGO03-MEINS .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO03.
    ENDIF.
ZOSTB_CATALOGO03-MANDT =
ZOSVA_CATALOGO03-MANDT .
ZOSTB_CATALOGO03-MEINS =
ZOSVA_CATALOGO03-MEINS .
ZOSTB_CATALOGO03-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO03-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO03 .
    ELSE.
    INSERT ZOSTB_CATALOGO03 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO03-UPD_FLAG,
STATUS_ZOSVA_CATALOGO03-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO03.
  SELECT SINGLE * FROM ZOSTB_CATALOGO03 WHERE
MEINS = ZOSVA_CATALOGO03-MEINS .
ZOSVA_CATALOGO03-MANDT =
ZOSTB_CATALOGO03-MANDT .
ZOSVA_CATALOGO03-MEINS =
ZOSTB_CATALOGO03-MEINS .
ZOSVA_CATALOGO03-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO03-ZZ_CODIGO_SUNAT .
    SELECT SINGLE * FROM T006 WHERE
MSEHI = ZOSTB_CATALOGO03-MEINS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T006A WHERE
MSEHI = T006-MSEHI AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
ZOSVA_CATALOGO03-MSEHT =
T006A-MSEHT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR ZOSVA_CATALOGO03-MSEHT .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR ZOSVA_CATALOGO03-MSEHT .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO03 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO03-MEINS TO
ZOSTB_CATALOGO03-MEINS .
MOVE ZOSVA_CATALOGO03-MANDT TO
ZOSTB_CATALOGO03-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO03'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO03 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO03'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_ZOSVA_CATALOGO03 USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
ZOSTB_CATALOGO03-MANDT =
ZOSVA_CATALOGO03-MANDT .
ZOSTB_CATALOGO03-MEINS =
ZOSVA_CATALOGO03-MEINS .
ZOSTB_CATALOGO03-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO03-ZZ_CODIGO_SUNAT .
    SELECT SINGLE * FROM T006 WHERE
MSEHI = ZOSTB_CATALOGO03-MEINS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T006A WHERE
MSEHI = T006-MSEHI AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
ZOSVA_CATALOGO03-MSEHT =
T006A-MSEHT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR ZOSVA_CATALOGO03-MSEHT .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR ZOSVA_CATALOGO03-MSEHT .
    ENDIF.
ENDFORM.
*...processing: ZOSVA_CATALOGO05................................*
FORM GET_DATA_ZOSVA_CATALOGO05.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO05 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO05 .
ZOSVA_CATALOGO05-MANDT =
ZOSTB_CATALOGO05-MANDT .
ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO05-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO05-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO05-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO05-ZZ_UN_ECE =
ZOSTB_CATALOGO05-ZZ_UN_ECE .
ZOSVA_CATALOGO05-ZZ_OPCION01 =
ZOSTB_CATALOGO05-ZZ_OPCION01 .
ZOSVA_CATALOGO05-ZZ_TRIBUTO_DET =
ZOSTB_CATALOGO05-ZZ_TRIBUTO_DET .
ZOSVA_CATALOGO05-ZZ_TRIBUTO_CAB =
ZOSTB_CATALOGO05-ZZ_TRIBUTO_CAB .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO05.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO05 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO05.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO05-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO05 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO05 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO05 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO05.
    ENDIF.
ZOSTB_CATALOGO05-MANDT =
ZOSVA_CATALOGO05-MANDT .
ZOSTB_CATALOGO05-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO05-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO05-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO05-ZZ_UN_ECE =
ZOSVA_CATALOGO05-ZZ_UN_ECE .
ZOSTB_CATALOGO05-ZZ_OPCION01 =
ZOSVA_CATALOGO05-ZZ_OPCION01 .
ZOSTB_CATALOGO05-ZZ_TRIBUTO_DET =
ZOSVA_CATALOGO05-ZZ_TRIBUTO_DET .
ZOSTB_CATALOGO05-ZZ_TRIBUTO_CAB =
ZOSVA_CATALOGO05-ZZ_TRIBUTO_CAB .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO05 .
    ELSE.
    INSERT ZOSTB_CATALOGO05 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO05-UPD_FLAG,
STATUS_ZOSVA_CATALOGO05-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO05.
  SELECT SINGLE * FROM ZOSTB_CATALOGO05 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO05-MANDT =
ZOSTB_CATALOGO05-MANDT .
ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO05-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO05-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO05-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO05-ZZ_UN_ECE =
ZOSTB_CATALOGO05-ZZ_UN_ECE .
ZOSVA_CATALOGO05-ZZ_OPCION01 =
ZOSTB_CATALOGO05-ZZ_OPCION01 .
ZOSVA_CATALOGO05-ZZ_TRIBUTO_DET =
ZOSTB_CATALOGO05-ZZ_TRIBUTO_DET .
ZOSVA_CATALOGO05-ZZ_TRIBUTO_CAB =
ZOSTB_CATALOGO05-ZZ_TRIBUTO_CAB .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO05 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO05-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO05-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO05-MANDT TO
ZOSTB_CATALOGO05-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO05'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO05 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO05'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO06................................*
FORM GET_DATA_ZOSVA_CATALOGO06.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO06 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO06 .
ZOSVA_CATALOGO06-MANDT =
ZOSTB_CATALOGO06-MANDT .
ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO06-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO06-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO06-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO06-NROLEN =
ZOSTB_CATALOGO06-NROLEN .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO06.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO06 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO06.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO06-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO06 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO06 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO06 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO06.
    ENDIF.
ZOSTB_CATALOGO06-MANDT =
ZOSVA_CATALOGO06-MANDT .
ZOSTB_CATALOGO06-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO06-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO06-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO06-NROLEN =
ZOSVA_CATALOGO06-NROLEN .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO06 .
    ELSE.
    INSERT ZOSTB_CATALOGO06 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO06-UPD_FLAG,
STATUS_ZOSVA_CATALOGO06-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO06.
  SELECT SINGLE * FROM ZOSTB_CATALOGO06 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO06-MANDT =
ZOSTB_CATALOGO06-MANDT .
ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO06-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO06-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO06-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO06-NROLEN =
ZOSTB_CATALOGO06-NROLEN .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO06 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO06-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO06-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO06-MANDT TO
ZOSTB_CATALOGO06-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO06'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO06 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO06'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO07................................*
FORM GET_DATA_ZOSVA_CATALOGO07.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO07 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO07 .
ZOSVA_CATALOGO07-MANDT =
ZOSTB_CATALOGO07-MANDT .
ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO07-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO07-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO07-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO07-ZZ_TRIBUTO =
ZOSTB_CATALOGO07-ZZ_TRIBUTO .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO07.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO07 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO07.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO07-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO07 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO07 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO07 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO07.
    ENDIF.
ZOSTB_CATALOGO07-MANDT =
ZOSVA_CATALOGO07-MANDT .
ZOSTB_CATALOGO07-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO07-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO07-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO07-ZZ_TRIBUTO =
ZOSVA_CATALOGO07-ZZ_TRIBUTO .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO07 .
    ELSE.
    INSERT ZOSTB_CATALOGO07 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO07-UPD_FLAG,
STATUS_ZOSVA_CATALOGO07-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO07.
  SELECT SINGLE * FROM ZOSTB_CATALOGO07 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO07-MANDT =
ZOSTB_CATALOGO07-MANDT .
ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO07-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO07-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO07-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO07-ZZ_TRIBUTO =
ZOSTB_CATALOGO07-ZZ_TRIBUTO .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO07 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO07-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO07-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO07-MANDT TO
ZOSTB_CATALOGO07-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO07'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO07 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO07'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO11................................*
FORM GET_DATA_ZOSVA_CATALOGO11.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO11 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO11 .
ZOSVA_CATALOGO11-MANDT =
ZOSTB_CATALOGO11-MANDT .
ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO11-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO11-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO11-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO11-ZZ_OPCION01 =
ZOSTB_CATALOGO11-ZZ_OPCION01 .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO11.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO11 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO11.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO11-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO11 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO11 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO11 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO11.
    ENDIF.
ZOSTB_CATALOGO11-MANDT =
ZOSVA_CATALOGO11-MANDT .
ZOSTB_CATALOGO11-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO11-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO11-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO11-ZZ_OPCION01 =
ZOSVA_CATALOGO11-ZZ_OPCION01 .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO11 .
    ELSE.
    INSERT ZOSTB_CATALOGO11 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO11-UPD_FLAG,
STATUS_ZOSVA_CATALOGO11-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO11.
  SELECT SINGLE * FROM ZOSTB_CATALOGO11 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO11-MANDT =
ZOSTB_CATALOGO11-MANDT .
ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO11-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO11-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO11-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO11-ZZ_OPCION01 =
ZOSTB_CATALOGO11-ZZ_OPCION01 .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO11 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO11-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO11-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO11-MANDT TO
ZOSTB_CATALOGO11-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO11'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO11 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO11'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO12................................*
FORM GET_DATA_ZOSVA_CATALOGO12.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO12 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO12 .
ZOSVA_CATALOGO12-MANDT =
ZOSTB_CATALOGO12-MANDT .
ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO12-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO12-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO12-ZZ_DESC_COD_SUNA .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO12.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO12 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO12.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO12-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO12 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO12 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO12 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO12.
    ENDIF.
ZOSTB_CATALOGO12-MANDT =
ZOSVA_CATALOGO12-MANDT .
ZOSTB_CATALOGO12-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO12-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO12-ZZ_DESC_COD_SUNA .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO12 .
    ELSE.
    INSERT ZOSTB_CATALOGO12 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO12-UPD_FLAG,
STATUS_ZOSVA_CATALOGO12-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO12.
  SELECT SINGLE * FROM ZOSTB_CATALOGO12 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO12-MANDT =
ZOSTB_CATALOGO12-MANDT .
ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO12-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO12-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO12-ZZ_DESC_COD_SUNA .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO12 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO12-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO12-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO12-MANDT TO
ZOSTB_CATALOGO12-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO12'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO12 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO12'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO14................................*
FORM GET_DATA_ZOSVA_CATALOGO14.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO14 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO14 .
ZOSVA_CATALOGO14-MANDT =
ZOSTB_CATALOGO14-MANDT .
ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO14-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO14-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO14-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO14-ZZ_OPCION01 =
ZOSTB_CATALOGO14-ZZ_OPCION01 .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO14.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO14 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO14.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO14-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO14 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO14 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO14 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO14.
    ENDIF.
ZOSTB_CATALOGO14-MANDT =
ZOSVA_CATALOGO14-MANDT .
ZOSTB_CATALOGO14-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO14-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO14-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO14-ZZ_OPCION01 =
ZOSVA_CATALOGO14-ZZ_OPCION01 .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO14 .
    ELSE.
    INSERT ZOSTB_CATALOGO14 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO14-UPD_FLAG,
STATUS_ZOSVA_CATALOGO14-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO14.
  SELECT SINGLE * FROM ZOSTB_CATALOGO14 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO14-MANDT =
ZOSTB_CATALOGO14-MANDT .
ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO14-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO14-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO14-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO14-ZZ_OPCION01 =
ZOSTB_CATALOGO14-ZZ_OPCION01 .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO14 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO14-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO14-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO14-MANDT TO
ZOSTB_CATALOGO14-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO14'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO14 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO14'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO15................................*
FORM GET_DATA_ZOSVA_CATALOGO15.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO15 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO15 .
ZOSVA_CATALOGO15-MANDT =
ZOSTB_CATALOGO15-MANDT .
ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO15-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO15-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO15-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO15-ZZ_OPCION01 =
ZOSTB_CATALOGO15-ZZ_OPCION01 .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO15.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO15 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO15.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO15-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO15 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO15 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO15 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO15.
    ENDIF.
ZOSTB_CATALOGO15-MANDT =
ZOSVA_CATALOGO15-MANDT .
ZOSTB_CATALOGO15-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO15-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO15-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO15-ZZ_OPCION01 =
ZOSVA_CATALOGO15-ZZ_OPCION01 .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO15 .
    ELSE.
    INSERT ZOSTB_CATALOGO15 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO15-UPD_FLAG,
STATUS_ZOSVA_CATALOGO15-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO15.
  SELECT SINGLE * FROM ZOSTB_CATALOGO15 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO15-MANDT =
ZOSTB_CATALOGO15-MANDT .
ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO15-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO15-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO15-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO15-ZZ_OPCION01 =
ZOSTB_CATALOGO15-ZZ_OPCION01 .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO15 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO15-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO15-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO15-MANDT TO
ZOSTB_CATALOGO15-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO15'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO15 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO15'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO16................................*
FORM GET_DATA_ZOSVA_CATALOGO16.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO16 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO16 .
ZOSVA_CATALOGO16-MANDT =
ZOSTB_CATALOGO16-MANDT .
ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO16-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO16-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO16-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO16-ZZ_OPCION01 =
ZOSTB_CATALOGO16-ZZ_OPCION01 .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO16.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO16 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO16.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO16-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO16 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO16 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO16 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO16.
    ENDIF.
ZOSTB_CATALOGO16-MANDT =
ZOSVA_CATALOGO16-MANDT .
ZOSTB_CATALOGO16-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO16-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO16-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO16-ZZ_OPCION01 =
ZOSVA_CATALOGO16-ZZ_OPCION01 .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO16 .
    ELSE.
    INSERT ZOSTB_CATALOGO16 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO16-UPD_FLAG,
STATUS_ZOSVA_CATALOGO16-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO16.
  SELECT SINGLE * FROM ZOSTB_CATALOGO16 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO16-MANDT =
ZOSTB_CATALOGO16-MANDT .
ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO16-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO16-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO16-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO16-ZZ_OPCION01 =
ZOSTB_CATALOGO16-ZZ_OPCION01 .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO16 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO16-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO16-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO16-MANDT TO
ZOSTB_CATALOGO16-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO16'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO16 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO16'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO17................................*
FORM GET_DATA_ZOSVA_CATALOGO17.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO17 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO17 .
ZOSVA_CATALOGO17-MANDT =
ZOSTB_CATALOGO17-MANDT .
ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO17-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO17-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO17-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO17-ZZ_CODINTABAP =
ZOSTB_CATALOGO17-ZZ_CODINTABAP .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO17.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO17 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO17.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO17-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO17 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO17 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO17 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO17.
    ENDIF.
ZOSTB_CATALOGO17-MANDT =
ZOSVA_CATALOGO17-MANDT .
ZOSTB_CATALOGO17-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO17-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO17-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO17-ZZ_CODINTABAP =
ZOSVA_CATALOGO17-ZZ_CODINTABAP .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO17 .
    ELSE.
    INSERT ZOSTB_CATALOGO17 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO17-UPD_FLAG,
STATUS_ZOSVA_CATALOGO17-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO17.
  SELECT SINGLE * FROM ZOSTB_CATALOGO17 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO17-MANDT =
ZOSTB_CATALOGO17-MANDT .
ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO17-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO17-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO17-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO17-ZZ_CODINTABAP =
ZOSTB_CATALOGO17-ZZ_CODINTABAP .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO17 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO17-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO17-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO17-MANDT TO
ZOSTB_CATALOGO17-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO17'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO17 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO17'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO18................................*
FORM GET_DATA_ZOSVA_CATALOGO18.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO18 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO18 .
ZOSVA_CATALOGO18-MANDT =
ZOSTB_CATALOGO18-MANDT .
ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO18-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO18-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO18-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO18-IS_TRANS_PUBLIC =
ZOSTB_CATALOGO18-IS_TRANS_PUBLIC .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO18.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO18 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO18.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO18-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO18 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO18 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO18 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO18.
    ENDIF.
ZOSTB_CATALOGO18-MANDT =
ZOSVA_CATALOGO18-MANDT .
ZOSTB_CATALOGO18-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO18-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO18-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO18-IS_TRANS_PUBLIC =
ZOSVA_CATALOGO18-IS_TRANS_PUBLIC .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO18 .
    ELSE.
    INSERT ZOSTB_CATALOGO18 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO18-UPD_FLAG,
STATUS_ZOSVA_CATALOGO18-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO18.
  SELECT SINGLE * FROM ZOSTB_CATALOGO18 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO18-MANDT =
ZOSTB_CATALOGO18-MANDT .
ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO18-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO18-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO18-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO18-IS_TRANS_PUBLIC =
ZOSTB_CATALOGO18-IS_TRANS_PUBLIC .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO18 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO18-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO18-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO18-MANDT TO
ZOSTB_CATALOGO18-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO18'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO18 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO18'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO20................................*
FORM GET_DATA_ZOSVA_CATALOGO20.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO20 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO20 .
ZOSVA_CATALOGO20-MANDT =
ZOSTB_CATALOGO20-MANDT .
ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO20-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO20-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO20-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO20-IS_TRASLADOINTERNO =
ZOSTB_CATALOGO20-IS_TRASLADOINTERNO .
ZOSVA_CATALOGO20-IS_DESC_CUST =
ZOSTB_CATALOGO20-IS_DESC_CUST .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO20.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO20 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO20.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO20-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO20 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO20 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO20 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO20.
    ENDIF.
ZOSTB_CATALOGO20-MANDT =
ZOSVA_CATALOGO20-MANDT .
ZOSTB_CATALOGO20-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO20-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO20-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO20-IS_TRASLADOINTERNO =
ZOSVA_CATALOGO20-IS_TRASLADOINTERNO .
ZOSTB_CATALOGO20-IS_DESC_CUST =
ZOSVA_CATALOGO20-IS_DESC_CUST .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO20 .
    ELSE.
    INSERT ZOSTB_CATALOGO20 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO20-UPD_FLAG,
STATUS_ZOSVA_CATALOGO20-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO20.
  SELECT SINGLE * FROM ZOSTB_CATALOGO20 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO20-MANDT =
ZOSTB_CATALOGO20-MANDT .
ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO20-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO20-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO20-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO20-IS_TRASLADOINTERNO =
ZOSTB_CATALOGO20-IS_TRASLADOINTERNO .
ZOSVA_CATALOGO20-IS_DESC_CUST =
ZOSTB_CATALOGO20-IS_DESC_CUST .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO20 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO20-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO20-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO20-MANDT TO
ZOSTB_CATALOGO20-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO20'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO20 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO20'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO21................................*
FORM GET_DATA_ZOSVA_CATALOGO21.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO21 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO21 .
ZOSVA_CATALOGO21-MANDT =
ZOSTB_CATALOGO21-MANDT .
ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO21-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO21-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO21-ZZ_DESC_COD_SUNA .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO21.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO21 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO21.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO21-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO21 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO21 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO21 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO21.
    ENDIF.
ZOSTB_CATALOGO21-MANDT =
ZOSVA_CATALOGO21-MANDT .
ZOSTB_CATALOGO21-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO21-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO21-ZZ_DESC_COD_SUNA .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO21 .
    ELSE.
    INSERT ZOSTB_CATALOGO21 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO21-UPD_FLAG,
STATUS_ZOSVA_CATALOGO21-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO21.
  SELECT SINGLE * FROM ZOSTB_CATALOGO21 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO21-MANDT =
ZOSTB_CATALOGO21-MANDT .
ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO21-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO21-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO21-ZZ_DESC_COD_SUNA .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO21 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO21-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO21-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO21-MANDT TO
ZOSTB_CATALOGO21-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO21'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO21 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO21'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO22................................*
FORM GET_DATA_ZOSVA_CATALOGO22.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO22 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO22 .
ZOSVA_CATALOGO22-MANDT =
ZOSTB_CATALOGO22-MANDT .
ZOSVA_CATALOGO22-CODSUN =
ZOSTB_CATALOGO22-CODSUN .
ZOSVA_CATALOGO22-DESSUN =
ZOSTB_CATALOGO22-DESSUN .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO22.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO22 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO22.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO22-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO22 WHERE
  CODSUN = ZOSVA_CATALOGO22-CODSUN .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO22 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO22 WHERE
  CODSUN = ZOSVA_CATALOGO22-CODSUN .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO22.
    ENDIF.
ZOSTB_CATALOGO22-MANDT =
ZOSVA_CATALOGO22-MANDT .
ZOSTB_CATALOGO22-CODSUN =
ZOSVA_CATALOGO22-CODSUN .
ZOSTB_CATALOGO22-DESSUN =
ZOSVA_CATALOGO22-DESSUN .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO22 .
    ELSE.
    INSERT ZOSTB_CATALOGO22 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO22-UPD_FLAG,
STATUS_ZOSVA_CATALOGO22-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO22.
  SELECT SINGLE * FROM ZOSTB_CATALOGO22 WHERE
CODSUN = ZOSVA_CATALOGO22-CODSUN .
ZOSVA_CATALOGO22-MANDT =
ZOSTB_CATALOGO22-MANDT .
ZOSVA_CATALOGO22-CODSUN =
ZOSTB_CATALOGO22-CODSUN .
ZOSVA_CATALOGO22-DESSUN =
ZOSTB_CATALOGO22-DESSUN .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO22 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO22-CODSUN TO
ZOSTB_CATALOGO22-CODSUN .
MOVE ZOSVA_CATALOGO22-MANDT TO
ZOSTB_CATALOGO22-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO22'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO22 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO22'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO23................................*
FORM GET_DATA_ZOSVA_CATALOGO23.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO23 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO23 .
ZOSVA_CATALOGO23-MANDT =
ZOSTB_CATALOGO23-MANDT .
ZOSVA_CATALOGO23-CODSUN =
ZOSTB_CATALOGO23-CODSUN .
ZOSVA_CATALOGO23-DESSUN =
ZOSTB_CATALOGO23-DESSUN .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO23.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO23 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO23.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO23-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO23 WHERE
  CODSUN = ZOSVA_CATALOGO23-CODSUN .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO23 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO23 WHERE
  CODSUN = ZOSVA_CATALOGO23-CODSUN .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO23.
    ENDIF.
ZOSTB_CATALOGO23-MANDT =
ZOSVA_CATALOGO23-MANDT .
ZOSTB_CATALOGO23-CODSUN =
ZOSVA_CATALOGO23-CODSUN .
ZOSTB_CATALOGO23-DESSUN =
ZOSVA_CATALOGO23-DESSUN .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO23 .
    ELSE.
    INSERT ZOSTB_CATALOGO23 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO23-UPD_FLAG,
STATUS_ZOSVA_CATALOGO23-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO23.
  SELECT SINGLE * FROM ZOSTB_CATALOGO23 WHERE
CODSUN = ZOSVA_CATALOGO23-CODSUN .
ZOSVA_CATALOGO23-MANDT =
ZOSTB_CATALOGO23-MANDT .
ZOSVA_CATALOGO23-CODSUN =
ZOSTB_CATALOGO23-CODSUN .
ZOSVA_CATALOGO23-DESSUN =
ZOSTB_CATALOGO23-DESSUN .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO23 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO23-CODSUN TO
ZOSTB_CATALOGO23-CODSUN .
MOVE ZOSVA_CATALOGO23-MANDT TO
ZOSTB_CATALOGO23-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO23'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO23 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO23'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO51................................*
FORM GET_DATA_ZOSVA_CATALOGO51.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO51 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO51 .
ZOSVA_CATALOGO51-MANDT =
ZOSTB_CATALOGO51-MANDT .
ZOSVA_CATALOGO51-CODSUN =
ZOSTB_CATALOGO51-CODSUN .
ZOSVA_CATALOGO51-DESSUN =
ZOSTB_CATALOGO51-DESSUN .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO51.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO51 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO51.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO51-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO51 WHERE
  CODSUN = ZOSVA_CATALOGO51-CODSUN .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO51 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO51 WHERE
  CODSUN = ZOSVA_CATALOGO51-CODSUN .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO51.
    ENDIF.
ZOSTB_CATALOGO51-MANDT =
ZOSVA_CATALOGO51-MANDT .
ZOSTB_CATALOGO51-CODSUN =
ZOSVA_CATALOGO51-CODSUN .
ZOSTB_CATALOGO51-DESSUN =
ZOSVA_CATALOGO51-DESSUN .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO51 .
    ELSE.
    INSERT ZOSTB_CATALOGO51 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO51-UPD_FLAG,
STATUS_ZOSVA_CATALOGO51-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO51.
  SELECT SINGLE * FROM ZOSTB_CATALOGO51 WHERE
CODSUN = ZOSVA_CATALOGO51-CODSUN .
ZOSVA_CATALOGO51-MANDT =
ZOSTB_CATALOGO51-MANDT .
ZOSVA_CATALOGO51-CODSUN =
ZOSTB_CATALOGO51-CODSUN .
ZOSVA_CATALOGO51-DESSUN =
ZOSTB_CATALOGO51-DESSUN .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO51 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO51-CODSUN TO
ZOSTB_CATALOGO51-CODSUN .
MOVE ZOSVA_CATALOGO51-MANDT TO
ZOSTB_CATALOGO51-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO51'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO51 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO51'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO52................................*
FORM GET_DATA_ZOSVA_CATALOGO52.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO52 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO52 .
ZOSVA_CATALOGO52-MANDT =
ZOSTB_CATALOGO52-MANDT .
ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO52-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO52-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO52-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO52-ZZ_CODINTABAP =
ZOSTB_CATALOGO52-ZZ_CODINTABAP .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO52.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO52 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO52.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO52-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO52 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO52 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO52 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO52.
    ENDIF.
ZOSTB_CATALOGO52-MANDT =
ZOSVA_CATALOGO52-MANDT .
ZOSTB_CATALOGO52-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO52-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO52-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO52-ZZ_CODINTABAP =
ZOSVA_CATALOGO52-ZZ_CODINTABAP .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO52 .
    ELSE.
    INSERT ZOSTB_CATALOGO52 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO52-UPD_FLAG,
STATUS_ZOSVA_CATALOGO52-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO52.
  SELECT SINGLE * FROM ZOSTB_CATALOGO52 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO52-MANDT =
ZOSTB_CATALOGO52-MANDT .
ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO52-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO52-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO52-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO52-ZZ_CODINTABAP =
ZOSTB_CATALOGO52-ZZ_CODINTABAP .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO52 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO52-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO52-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO52-MANDT TO
ZOSTB_CATALOGO52-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO52'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO52 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO52'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO53................................*
FORM GET_DATA_ZOSVA_CATALOGO53.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO53 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO53 .
ZOSVA_CATALOGO53-MANDT =
ZOSTB_CATALOGO53-MANDT .
ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO53-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO53-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO53-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO53-ZZ_NABI =
ZOSTB_CATALOGO53-ZZ_NABI .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO53.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO53 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO53.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO53-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO53 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO53 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO53 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO53.
    ENDIF.
ZOSTB_CATALOGO53-MANDT =
ZOSVA_CATALOGO53-MANDT .
ZOSTB_CATALOGO53-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO53-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO53-ZZ_DESC_COD_SUNA .
ZOSTB_CATALOGO53-ZZ_NABI =
ZOSVA_CATALOGO53-ZZ_NABI .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO53 .
    ELSE.
    INSERT ZOSTB_CATALOGO53 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO53-UPD_FLAG,
STATUS_ZOSVA_CATALOGO53-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO53.
  SELECT SINGLE * FROM ZOSTB_CATALOGO53 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO53-MANDT =
ZOSTB_CATALOGO53-MANDT .
ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO53-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO53-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO53-ZZ_DESC_COD_SUNA .
ZOSVA_CATALOGO53-ZZ_NABI =
ZOSTB_CATALOGO53-ZZ_NABI .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO53 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO53-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO53-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO53-MANDT TO
ZOSTB_CATALOGO53-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO53'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO53 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO53'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO54................................*
FORM GET_DATA_ZOSVA_CATALOGO54.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO54 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO54 .
ZOSVA_CATALOGO54-MANDT =
ZOSTB_CATALOGO54-MANDT .
ZOSVA_CATALOGO54-CODSUN =
ZOSTB_CATALOGO54-CODSUN .
ZOSVA_CATALOGO54-DESSUN =
ZOSTB_CATALOGO54-DESSUN .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO54.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO54 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO54.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO54-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO54 WHERE
  CODSUN = ZOSVA_CATALOGO54-CODSUN .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO54 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO54 WHERE
  CODSUN = ZOSVA_CATALOGO54-CODSUN .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO54.
    ENDIF.
ZOSTB_CATALOGO54-MANDT =
ZOSVA_CATALOGO54-MANDT .
ZOSTB_CATALOGO54-CODSUN =
ZOSVA_CATALOGO54-CODSUN .
ZOSTB_CATALOGO54-DESSUN =
ZOSVA_CATALOGO54-DESSUN .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO54 .
    ELSE.
    INSERT ZOSTB_CATALOGO54 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO54-UPD_FLAG,
STATUS_ZOSVA_CATALOGO54-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO54.
  SELECT SINGLE * FROM ZOSTB_CATALOGO54 WHERE
CODSUN = ZOSVA_CATALOGO54-CODSUN .
ZOSVA_CATALOGO54-MANDT =
ZOSTB_CATALOGO54-MANDT .
ZOSVA_CATALOGO54-CODSUN =
ZOSTB_CATALOGO54-CODSUN .
ZOSVA_CATALOGO54-DESSUN =
ZOSTB_CATALOGO54-DESSUN .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO54 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO54-CODSUN TO
ZOSTB_CATALOGO54-CODSUN .
MOVE ZOSVA_CATALOGO54-MANDT TO
ZOSTB_CATALOGO54-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO54'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO54 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO54'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO59................................*
FORM GET_DATA_ZOSVA_CATALOGO59.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO59 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO59 .
ZOSVA_CATALOGO59-MANDT =
ZOSTB_CATALOGO59-MANDT .
ZOSVA_CATALOGO59-CODSUN =
ZOSTB_CATALOGO59-CODSUN .
ZOSVA_CATALOGO59-DESSUN =
ZOSTB_CATALOGO59-DESSUN .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO59.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO59 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO59.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO59-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO59 WHERE
  CODSUN = ZOSVA_CATALOGO59-CODSUN .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO59 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO59 WHERE
  CODSUN = ZOSVA_CATALOGO59-CODSUN .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO59.
    ENDIF.
ZOSTB_CATALOGO59-MANDT =
ZOSVA_CATALOGO59-MANDT .
ZOSTB_CATALOGO59-CODSUN =
ZOSVA_CATALOGO59-CODSUN .
ZOSTB_CATALOGO59-DESSUN =
ZOSVA_CATALOGO59-DESSUN .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO59 .
    ELSE.
    INSERT ZOSTB_CATALOGO59 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO59-UPD_FLAG,
STATUS_ZOSVA_CATALOGO59-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO59.
  SELECT SINGLE * FROM ZOSTB_CATALOGO59 WHERE
CODSUN = ZOSVA_CATALOGO59-CODSUN .
ZOSVA_CATALOGO59-MANDT =
ZOSTB_CATALOGO59-MANDT .
ZOSVA_CATALOGO59-CODSUN =
ZOSTB_CATALOGO59-CODSUN .
ZOSVA_CATALOGO59-DESSUN =
ZOSTB_CATALOGO59-DESSUN .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO59 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO59-CODSUN TO
ZOSTB_CATALOGO59-CODSUN .
MOVE ZOSVA_CATALOGO59-MANDT TO
ZOSTB_CATALOGO59-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO59'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO59 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO59'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZOSVA_CATALOGO61................................*
FORM GET_DATA_ZOSVA_CATALOGO61.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZOSTB_CATALOGO61 WHERE
(VIM_WHERETAB) .
    CLEAR ZOSVA_CATALOGO61 .
ZOSVA_CATALOGO61-MANDT =
ZOSTB_CATALOGO61-MANDT .
ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO61-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO61-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO61-ZZ_DESC_COD_SUNA .
<VIM_TOTAL_STRUC> = ZOSVA_CATALOGO61.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZOSVA_CATALOGO61 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZOSVA_CATALOGO61.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZOSVA_CATALOGO61-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO61 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC = 0.
    DELETE ZOSTB_CATALOGO61 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZOSTB_CATALOGO61 WHERE
  ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZOSTB_CATALOGO61.
    ENDIF.
ZOSTB_CATALOGO61-MANDT =
ZOSVA_CATALOGO61-MANDT .
ZOSTB_CATALOGO61-ZZ_CODIGO_SUNAT =
ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT .
ZOSTB_CATALOGO61-ZZ_DESC_COD_SUNA =
ZOSVA_CATALOGO61-ZZ_DESC_COD_SUNA .
    IF SY-SUBRC = 0.
    UPDATE ZOSTB_CATALOGO61 .
    ELSE.
    INSERT ZOSTB_CATALOGO61 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZOSVA_CATALOGO61-UPD_FLAG,
STATUS_ZOSVA_CATALOGO61-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZOSVA_CATALOGO61.
  SELECT SINGLE * FROM ZOSTB_CATALOGO61 WHERE
ZZ_CODIGO_SUNAT = ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO61-MANDT =
ZOSTB_CATALOGO61-MANDT .
ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT =
ZOSTB_CATALOGO61-ZZ_CODIGO_SUNAT .
ZOSVA_CATALOGO61-ZZ_DESC_COD_SUNA =
ZOSTB_CATALOGO61-ZZ_DESC_COD_SUNA .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZOSVA_CATALOGO61 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZOSVA_CATALOGO61-ZZ_CODIGO_SUNAT TO
ZOSTB_CATALOGO61-ZZ_CODIGO_SUNAT .
MOVE ZOSVA_CATALOGO61-MANDT TO
ZOSTB_CATALOGO61-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZOSTB_CATALOGO61'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZOSTB_CATALOGO61 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZOSTB_CATALOGO61'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
